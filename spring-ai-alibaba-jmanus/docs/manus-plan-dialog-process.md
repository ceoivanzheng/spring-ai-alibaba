# 复杂任务规划对话流程

## 核心逻辑框架

流程的核心逻辑是以 **"目标"** 为导向，通过 **"输入"** 提供基础，由 **"参与者"** 按 **"规则"** 执行 **"活动"**（活动间按 **"逻辑关系"** 衔接），消耗 **"资源"**，最终产生 **"输出"** 以达成目标。

## 用例场景流程

### 场景描述

用户在JManus系统首页输入："用浏览器基于百度，查询今天阿里巴巴的股价，并返回最新股价"，系统需要理解复合任务需求，分解为多步骤计划，使用浏览器工具执行网页搜索，提取股价信息并返回结果。

### 流程要素分析表


| 要素         | 内容                                                                                   | 具体描述                                                                                          |
| ------------ | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| **目标**     | 获取阿里巴巴最新股价信息                                                               | 通过浏览器搜索获取准确的阿里巴巴当日股价数据并返回给用户                                          |
| **输入**     | 用户自然语言指令                                                                       | "用浏览器基于百度，查询今天阿里巴巴的股价，并返回最新股价"                                        |
| **参与者**   | - 用户<br>- JManus AI系统<br>- 规划模块<br>- 浏览器工具                                | - 用户：提供需求指令<br>- JManus AI：理解和协调<br>- 规划模块：任务分解<br>- 浏览器工具：执行搜索 |
| **规则**     | - 任务理解规则<br>- 计划分解规则<br>- 工具调用规则<br>- 信息提取规则                   | - 解析复合任务意图<br>- 按逻辑顺序分解步骤<br>- 选择合适工具执行<br>- 提取关键信息返回            |
| **活动**     | 1. 任务理解<br>2. 计划生成<br>3. 工具选择<br>4. 搜索执行<br>5. 信息提取<br>6. 结果返回 | 详见下方活动流程表                                                                                |
| **逻辑关系** | 顺序执行 + 条件判断                                                                    | 各活动按顺序执行，如搜索失败则重试或调整策略                                                      |
| **资源**     | - 浏览器工具<br>- 百度搜索引擎<br>- 网络连接<br>- AI推理能力                           | - 自动化浏览器实例<br>- 搜索API接口<br>- 稳定网络环境<br>- 自然语言处理能力                       |
| **输出**     | 阿里巴巴最新股价信息                                                                   | 结构化的股价数据，包括价格、涨跌幅等关键信息                                                      |

### 详细活动流程表


| 序号 | 活动名称 | 执行者     | 输入           | 输出           | 资源消耗          | 成功条件                   |
| ---- | -------- | ---------- | -------------- | -------------- | ----------------- | -------------------------- |
| 1    | 任务理解 | JManus AI  | 用户原始指令   | 结构化任务对象 | AI推理能力        | 正确识别查询意图和目标股票 |
| 2    | 计划生成 | 规划模块   | 结构化任务对象 | 执行计划步骤   | AI规划能力        | 生成可执行的步骤序列       |
| 3    | 工具选择 | JManus AI  | 执行计划       | 浏览器工具实例 | 工具调用接口      | 成功启动浏览器工具         |
| 4    | 搜索执行 | 浏览器工具 | 搜索关键词     | 网页搜索结果   | 网络连接、搜索API | 获取到相关搜索结果页面     |
| 5    | 信息提取 | JManus AI  | 网页内容       | 股价数据       | AI信息提取能力    | 准确提取股价关键信息       |
| 6    | 结果返回 | JManus AI  | 股价数据       | 格式化回复     | 文本生成能力      | 清晰准确地返回股价信息     |

### 异常处理流程


| 异常情况     | 处理策略     | 备选方案                       |
| ------------ | ------------ | ------------------------------ |
| 网络连接失败 | 重试机制     | 提示用户网络问题，建议稍后重试 |
| 搜索结果为空 | 调整关键词   | 使用不同搜索词或搜索引擎       |
| 信息提取失败 | 重新解析页面 | 尝试访问其他财经网站           |
| 工具调用超时 | 增加超时时间 | 切换到备用工具或API            |

### 成功指标

- **准确性**：返回的股价信息与实际市场数据一致
- **及时性**：整个流程在30秒内完成
- **完整性**：包含股价、涨跌幅等关键信息
- **用户体验**：返回结果清晰易懂，格式友好

### 优化建议

1. **缓存机制**：对热门股票信息进行短期缓存，提高响应速度
2. **多源验证**：同时查询多个财经网站，确保数据准确性
3. **实时监控**：监控各个步骤的执行时间和成功率
4. **智能重试**：根据失败原因智能选择重试策略
